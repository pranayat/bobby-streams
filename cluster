version: '3.1'

services:
  zookeeper:
    image: zookeeper
    container_name: zookeeper
    restart: always

  nimbus:
    image: storm
    container_name: nimbus
    command: ["/bin/bash", "/storm-nimbus/startup.sh"]
    depends_on:
      - zookeeper
    links:
      - zookeeper
    restart: always
    ports:
      - 6627:6627 # thrift
      - 8000:8080 #ui
    volumes:
        - './storm-nimbus:/storm-nimbus'

  supervisor:
    image: storm
    container_name: supervisor
    command: storm supervisor
    depends_on:
      - nimbus
      - zookeeper
    links:
      - nimbus
      - zookeeper
    restart: always

  data-reader:
    container_name: data-reader
    build: ./data-reader
    depends_on:
      - redis
    ports:
      - 5678:5678
    tty: true
    volumes:
      - './data-reader:/data-reader'

  redis:
    container_name: redis
    image: redis:latest
    ports:
      - "6379:6379"            

volumes:
    storm-nimbus:
    data-reader: